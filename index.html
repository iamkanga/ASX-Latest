<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÜ</text></svg>">

    <link rel="stylesheet" href="style.css?v=81"> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-top-row">
            <button id="hamburgerBtn" class="hamburger-btn header-action-btn-left">
                <i class="fas fa-bars"></i>
            </button>
            <h1 id="mainTitle">Share Watchlist</h1> <button id="addShareHeaderBtn" class="header-action-btn header-action-btn-right">
                <i class="fas fa-plus"></i>
            </button>
        </div>

        <nav id="appSidebar" class="app-sidebar">
            <button id="closeMenuBtn" class="close-menu-btn">X</button>
            
            <div class="menu-section">
                <h3>Share Actions</h3>
                <div class="menu-buttons-group">
                    <button id="newShareBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-plus-circle"></i> <span>Add New Share</span>
                    </button>
                </div>
            </div>

            <div class="menu-section">
                <h3>Watchlists</h3>
                <div class="menu-buttons-group">
                    <button id="addWatchlistBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-list-ul"></i> <span>Add Watchlist</span>
                    </button>
                    <button id="editWatchlistBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-edit"></i> <span>Edit Current Watchlist</span>
                    </button>
                </div>
            </div>

            <div class="menu-section">
                <h3>Calculators</h3>
                <div class="menu-buttons-group">
                    <button id="standardCalcBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-calculator"></i> <span>Standard</span>
                    </button>
                    <button id="dividendCalcBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-money-bill-wave"></i> <span>Dividend</span>
                    </button>
                </div>
            </div>

            <div class="menu-section">
                <h3>Data Actions</h3>
                <div class="menu-buttons-group">
                    <button id="exportWatchlistBtn" class="menu-button-item" data-action-closes-menu="true">
                        <i class="fas fa-file-export"></i> <span>Export Watchlist</span>
                    </button>
                </div>
            </div>

            <div class="menu-section">
                <h3>App Settings</h3>
                <div class="menu-buttons-group">
                    <button id="themeToggleBtn" class="menu-button-item" data-action-closes-menu="false">
                        <i class="fas fa-moon"></i> <span>Dark Mode</span>
                    </button>
                    <button id="colorThemeSelect" class="menu-button-item" data-action-closes-menu="false">
                        <i class="fas fa-palette"></i> <span>Color Theme</span>
                    </button>
                    <button id="revertToDefaultThemeBtn" class="menu-button-item icon-only" data-action-closes-menu="false">
                        <i class="fas fa-undo"></i><i class="fas fa-paint-roller"></i> 
                    </button>
                </div>
            </div>

            <div class="menu-section bottom-section">
                <div class="menu-buttons-group">
                    <button id="googleAuthBtn" class="google-auth-btn menu-button-item" disabled>
                        <i class="fab fa-google"></i> Sign In
                    </button>
                    <span id="logoutBtn" class="menu-button-item icon-only" data-action-closes-menu="true">
                        <i class="fas fa-sign-out-alt"></i>
                    </span>
                </div>
            </div>
        </nav>
        <div class="sidebar-overlay"></div>
    </header>

    <main class="content">
        <section id="shareListSection" class="share-list-section">
            <div class="watchlist-controls-row">
                <div class="watchlist-group">
                    <label for="watchlistSelect">Watchlist:</label>
                    <select id="watchlistSelect" class="dropdown-large" disabled>
                        </select>
                </div>
                <div class="sort-group">
                    <label for="sortSelect">Sort by:</label>
                    <select id="sortSelect" class="dropdown-large" disabled>
                        <option value="shareName-asc">Name (A-Z)</option>
                        <option value="shareName-desc">Name (Z-A)</option>
                        <option value="currentPrice-desc">Current Price (High-Low)</option>
                        <option value="currentPrice-asc">Current Price (Low-High)</option>
                        <option value="dividendAmount-desc">Dividend (High-Low)</option>
                        <option value="dividendAmount-asc">Dividend (Low-High)</option>
                        <option value="unfrankedYield-desc">Unfranked Yield (High-Low)</option>
                        <option value="unfrankedYield-asc">Unfranked Yield (Low-High)</option>
                        <option value="frankingCredits-desc">Franking (High-Low)</option>
                        <option value="frankingCredits-asc">Franking (Low-High)</option>
                        <option value="targetPrice-desc">Target Price (High-Low)</option>
                        <option value="targetPrice-asc">Target Price (Low-High)</option>
                        <option value="entryDate-desc">Entry Date (Newest)</option>
                        <option value="entryDate-asc">Entry Date (Oldest)</option>
                    </select>
                </div>
            </div>

            <div class="loading" id="loadingIndicator" style="display: none;">
                Loading shares...
            </div>
            <div class="error-message" id="firebaseInitError" style="display: none;">
                Firebase did not initialize correctly. Please check your internet connection or browser settings.
            </div>

            <table id="shareTable">
                <thead>
                    <tr>
                        <th>Share Name</th>
                        <th>Current Price</th>
                        <th>Target Price</th>
                        <th>Dividend</th>
                        <th>Franking</th>
                        <th>Unfranked Yield</th>
                        <th>Franked Yield</th>
                        <th>Entered Price</th>
                        <th>Entry Date</th>
                        <th>Last Price Update</th>
                        <th class="table-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>

            <div id="mobileShareCards" class="mobile-share-cards">
                </div>
        </section>

        <section id="shareFormSection" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="formTitle">Add New Share</h2>
                    <span class="form-close-button close-btn" aria-label="Close Share Form">&times;</span>
                </div>
                <div class="modal-body modal-body-scrollable">
                    <label for="shareName">Share Name:</label>
                    <input type="text" id="shareName" required placeholder="e.g., CBA, BHP" />

                    <label for="currentPrice">Current Price ($):</label>
                    <input type="number" id="currentPrice" step="0.01" min="0" placeholder="e.g., 100.50" />

                    <label for="targetPrice">Target Price ($):</label>
                    <input type="number" id="targetPrice" step="0.01" min="0" placeholder="e.g., 105.00" />

                    <label for="dividendAmount">Dividend Amount ($ per share):</label>
                    <input type="number" id="dividendAmount" step="0.01" min="0" placeholder="e.g., 2.50" />

                    <label for="frankingCredits">Franking Credits (%):</label>
                    <input type="number" id="frankingCredits" step="any" min="0" max="100" placeholder="e.g., 70, 100 (for fully franked)" />

                    <div id="commentsFormContainer" class="comments-form-container">
                        </div>
                    <span id="addCommentSectionBtn" class="modal-action-icon add-comment-btn" aria-label="Add Comment">
                        <i class="fas fa-comment-dots"></i> Add Comment
                    </span>
                </div>
                <div class="modal-footer">
                    <span id="deleteShareBtn" class="modal-action-icon delete-icon hidden" aria-label="Delete Share">
                        <i class="fas fa-trash-alt"></i>
                    </span>
                    <span id="cancelFormBtn" class="modal-action-icon cancel-icon" aria-label="Cancel">
                        <i class="fas fa-times-circle"></i>
                    </span>
                    <span id="saveShareBtn" class="modal-action-icon save-icon" aria-label="Save Share">
                        <i class="fas fa-check-circle"></i>
                    </span>
                </div>
            </div>
        </section>

        <section id="shareDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalShareName">Share Details</h2>
                    <span class="close-btn" aria-label="Close Share Details">&times;</span>
                </div>
                <div class="modal-body modal-body-scrollable">
                    <p><strong>Entry Date:</strong> <span id="modalEntryDate"></span></p>
                    <p><strong>Entered Price:</strong> <span id="modalEnteredPrice"></span></p>
                    <p><strong>Current Price:</strong> <span id="modalCurrentPrice"></span></p>
                    <p><strong>Target Price:</strong> <span id="modalTargetPrice"></span></p>
                    <p><strong>Dividend Amount:</strong> <span id="modalDividendAmount"></span></p>
                    <p><strong>Franking Credits:</strong> <span id="modalFrankingCredits"></span></p>
                    <p><strong>Unfranked Yield:</strong> <span id="modalUnfrankedYield"></span></p>
                    <p><strong>Franked Yield:</strong> <span id="modalFrankedYield"></span></p>
                    <div class="comments-display-container" id="modalCommentsContainer">
                        </div>

                    <div class="external-links">
                        <p>More Info:</p>
                        <a id="modalMarketIndexLink" href="#" target="_blank" class="external-link-btn" style="display: none;">
                            <i class="fas fa-chart-line"></i> Market Index
                        </a>
                        <a id="modalFoolLink" href="#" target="_blank" class="external-link-btn" style="display: none;">
                            <i class="fas fa-money-bill-alt"></i> Motley Fool
                        </a>
                        <a id="modalCommSecLink" href="#" target="_blank" class="external-link-btn" style="display: none;">
                            <i class="fas fa-university"></i> CommSec
                        </a>
                        <p id="commSecLoginMessage" class="ghosted-text" style="display: none;">
                            Note: CommSec links may require a login to view content.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <span id="editShareFromDetailBtn" class="modal-action-icon edit-icon" aria-label="Edit Share">
                        <i class="fas fa-edit"></i>
                    </span>
                </div>
            </div>
        </section>

        <section id="dividendCalculatorModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Dividend Calculator</h2>
                    <span class="calc-close-button close-btn" aria-label="Close Calculator">&times;</span>
                </div>
                <div class="modal-body">
                    <label for="calcCurrentPrice">Current Price ($):</label>
                    <input type="number" id="calcCurrentPrice" step="0.01" min="0" placeholder="e.g., 100.50" />

                    <label for="calcDividendAmount">Dividend Amount ($ per share):</label>
                    <input type="number" id="calcDividendAmount" step="0.01" min="0" placeholder="e.g., 2.50" />

                    <label for="calcFrankingCredits">Franking Credits (%):</label>
                    <input type="number" id="calcFrankingCredits" step="any" min="0" max="100" placeholder="e.g., 70, 100" />

                    <p><strong>Unfranked Yield:</strong> <span id="calcUnfrankedYield">0.00%</span></p>
                    <p><strong>Franked Yield:</strong> <span id="calcFrankedYield">0.00%</span></p>

                    <label for="investmentValueSelect">Estimated Investment Value ($):</label>
                    <input type="number" id="investmentValueSelect" step="1" min="0" placeholder="e.g., 1000, 5000" />
                    
                    <p><strong>Estimated Annual Dividend:</strong> <span id="calcEstimatedDividend">$0.00</span></p>
                </div>
            </div>
        </section>

        <section id="calculatorModal" class="modal">
            <div class="modal-content calculator-content">
                <div class="modal-header">
                    <h2>Calculator</h2>
                    <span class="close-btn" aria-label="Close Calculator">&times;</span>
                </div>
                <div class="modal-body calculator-body">
                    <div class="calculator-display">
                        <div id="calculatorInput" class="input"></div>
                        <div id="calculatorResult" class="result">0</div>
                    </div>
                    <div class="calculator-buttons">
                        </div>
                </div>
            </div>
        </section>

        <section id="customDialogModal" class="modal custom-dialog-modal">
            <div class="modal-content custom-dialog-content">
                <div class="modal-body">
                    <p id="customDialogMessage"></p>
                </div>
                <div class="modal-footer">
                    <span id="customDialogConfirmBtn" class="modal-action-icon dialog-confirm-icon" aria-label="Confirm">
                        <i class="fas fa-check-circle"></i>
                    </span>
                    <span id="customDialogCancelBtn" class="modal-action-icon dialog-cancel-icon" aria-label="Cancel">
                        <i class="fas fa-times-circle"></i>
                    </span>
                </div>
            </div>
        </section>

        <section id="addWatchlistModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add New Watchlist</h2>
                    <span class="close-btn" aria-label="Close Add Watchlist Modal">&times;</span>
                </div>
                <div class="modal-body">
                    <label for="newWatchlistName">Watchlist Name:</label>
                    <input type="text" id="newWatchlistName" required placeholder="e.g., My Growth Stocks" />
                </div>
                <div class="modal-footer">
                    <span id="cancelAddWatchlistBtn" class="modal-action-icon cancel-icon" aria-label="Cancel">
                        <i class="fas fa-times-circle"></i>
                    </span>
                    <span id="saveWatchlistBtn" class="modal-action-icon save-icon" aria-label="Save Watchlist">
                        <i class="fas fa-check-circle"></i>
                    </span>
                </div>
            </div>
        </section>

        <section id="manageWatchlistModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Watchlist</h2>
                    <span class="close-btn" aria-label="Close Edit Watchlist Modal">&times;</span>
                </div>
                <div class="modal-body">
                    <label for="editWatchlistName">Watchlist Name:</label>
                    <input type="text" id="editWatchlistName" required />
                </div>
                <div class="modal-footer">
                    <span id="deleteWatchlistInModalBtn" class="modal-action-icon delete-icon" aria-label="Delete Watchlist">
                        <i class="fas fa-trash-alt"></i>
                    </span>
                    <span id="cancelManageWatchlistBtn" class="modal-action-icon cancel-icon" aria-label="Cancel">
                        <i class="fas fa-times-circle"></i>
                    </span>
                    <span id="saveWatchlistNameBtn" class="modal-action-icon save-icon" aria-label="Save Changes">
                        <i class="fas fa-check-circle"></i>
                    </span>
                </div>
            </div>
        </section>

        <div id="shareContextMenu" class="context-menu">
            <button id="contextEditShareBtn">
                <i class="fas fa-edit"></i> Edit Share
            </button>
            <button id="contextDeleteShareBtn">
                <i class="fas fa-trash-alt"></i> Delete Share
            </button>
        </div>

    </main>

    <footer class="fixed-footer">
        <button id="scrollToTopBtn" class="scroll-to-top-btn" aria-label="Scroll to top">
            <i class="fas fa-arrow-up"></i>
        </button>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>

    <script type="module">
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "[YOUR_API_KEY]",
            authDomain: "[YOUR_AUTH_DOMAIN]",
            projectId: "[YOUR_PROJECT_ID]",
            storageBucket: "[YOUR_STORAGE_BUCKET]",
            messagingSenderId: "[YOUR_MESSAGING_SENDER_ID]",
            appId: "[YOUR_APP_ID]"
        };

        let firebaseInitialized = false;
        let db = null;
        let auth = null;
        let currentAppId = null;

        try {
            // Initialize Firebase if not already initialized
            const app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
            currentAppId = firebaseConfig.appId;
            firebaseInitialized = true;
            console.log("Firebase app initialized successfully in index.html module script.");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            const errorDiv = document.getElementById('firebaseInitError');
            if (errorDiv) {
                errorDiv.style.display = 'block';
            }
            firebaseInitialized = false;
        }

        window.firestoreDb = firebaseInitialized ? db : null;
        window.firebaseAuth = firebaseInitialized ? auth : null;
        window.getFirebaseAppId = () => currentAppId;
        window.firestore = firebaseInitialized ? {
            collection: firebase.firestore.collection,
            doc: firebase.firestore.doc,
            getDoc: firebase.firestore.getDoc,
            addDoc: firebase.firestore.addDoc,
            setDoc: firebase.firestore.setDoc,
            updateDoc: firebase.firestore.updateDoc,
            deleteDoc: firebase.firestore.deleteDoc,
            onSnapshot: firebase.firestore.onSnapshot,
            query: firebase.firestore.query,
            where: firebase.firestore.where,
            getDocs: firebase.firestore.getDocs,
            deleteField: firebase.firestore.FieldValue.delete,
            writeBatch: firebase.firestore.writeBatch
        } : null;
        
        window.authFunctions = firebaseInitialized ? {
            GoogleAuthProviderInstance: firebase.auth.GoogleAuthProvider,
            signInAnonymously: firebase.auth.signInAnonymously,
            signInWithCustomToken: firebase.auth.signInWithCustomToken,
            signInWithPopup: firebase.auth.signInWithPopup,
            signOut: firebase.auth.signOut,
            onAuthStateChanged: firebase.auth.onAuthStateChanged
        } : null;

        document.addEventListener('DOMContentLoaded', async function() {
            console.log("index.html (v77) script module loaded and DOMContentLoaded fired."); // Updated version number
        }); 
    </script>
    <script src="script.js?v=144"></script> </body>
</html>